 classdef Blowfish
    
    properties
        sbox
        P
        N
    end
    
    methods
        function obj =  Blowfish(~)
            obj.sbox = [3509652390.00000,2564797868.00000,805139163,3491422135.00000,3101798381.00000,1780907670.00000,3128725573.00000,4046225305.00000,614570311,3012652279.00000,134345442,2240740374.00000,1667834072.00000,1901547113.00000,2757295779.00000,4103290238.00000,227898511,1921955416.00000,1904987480.00000,2182433518.00000,2069144605.00000,3260701109.00000,2620446009.00000,720527379,3318853667.00000,677414384,3393288472.00000,3101374703.00000,2390351024.00000,1614419982.00000,1822297739.00000,2954791486.00000,3608508353.00000,3174124327.00000,2024746970.00000,1432378464.00000,3864339955.00000,2857741204.00000,1464375394.00000,1676153920.00000,1439316330.00000,715854006,3033291828.00000,289532110,2706671279.00000,2087905683.00000,3018724369.00000,1668267050.00000,732546397,1947742710.00000,3462151702.00000,2609353502.00000,2950085171.00000,1814351708.00000,2050118529.00000,680887927,999245976,1800124847.00000,3300911131.00000,1713906067.00000,1641548236.00000,4213287313.00000,1216130144.00000,1575780402.00000,4018429277.00000,3917837745.00000,3693486850.00000,3949271944.00000,596196993,3549867205.00000,258830323,2213823033.00000,772490370,2760122372.00000,1774776394.00000,2652871518.00000,566650946,4142492826.00000,1728879713.00000,2882767088.00000,1783734482.00000,3629395816.00000,2517608232.00000,2874225571.00000,1861159788.00000,326777828,3124490320.00000,2130389656.00000,2716951837.00000,967770486,1724537150.00000,2185432712.00000,2364442137.00000,1164943284.00000,2105845187.00000,998989502,3765401048.00000,2244026483.00000,1075463327.00000,1455516326.00000,1322494562.00000,910128902,469688178,1117454909.00000,936433444,3490320968.00000,3675253459.00000,1240580251.00000,122909385,2157517691.00000,634681816,4142456567.00000,3825094682.00000,3061402683.00000,2540495037.00000,79693498,3249098678.00000,1084186820.00000,1583128258.00000,426386531,1761308591.00000,1047286709.00000,322548459,995290223,1845252383.00000,2603652396.00000,3431023940.00000,2942221577.00000,3202600964.00000,3727903485.00000,1712269319.00000,422464435,3234572375.00000,1170764815.00000,3523960633.00000,3117677531.00000,1434042557.00000,442511882,3600875718.00000,1076654713.00000,1738483198.00000,4213154764.00000,2393238008.00000,3677496056.00000,1014306527.00000,4251020053.00000,793779912,2902807211.00000,842905082,4246964064.00000,1395751752.00000,1040244610.00000,2656851899.00000,3396308128.00000,445077038,3742853595.00000,3577915638.00000,679411651,2892444358.00000,2354009459.00000,1767581616.00000,3150600392.00000,3791627101.00000,3102740896.00000,284835224,4246832056.00000,1258075500.00000,768725851,2589189241.00000,3069724005.00000,3532540348.00000,1274779536.00000,3789419226.00000,2764799539.00000,1660621633.00000,3471099624.00000,4011903706.00000,913787905,3497959166.00000,737222580,2514213453.00000,2928710040.00000,3937242737.00000,1804850592.00000,3499020752.00000,2949064160.00000,2386320175.00000,2390070455.00000,2415321851.00000,4061277028.00000,2290661394.00000,2416832540.00000,1336762016.00000,1754252060.00000,3520065937.00000,3014181293.00000,791618072,3188594551.00000,3933548030.00000,2332172193.00000,3852520463.00000,3043980520.00000,413987798,3465142937.00000,3030929376.00000,4245938359.00000,2093235073.00000,3534596313.00000,375366246,2157278981.00000,2479649556.00000,555357303,3870105701.00000,2008414854.00000,3344188149.00000,4221384143.00000,3956125452.00000,2067696032.00000,3594591187.00000,2921233993.00000,2428461,544322398,577241275,1471733935.00000,610547355,4027169054.00000,1432588573.00000,1507829418.00000,2025931657.00000,3646575487.00000,545086370,48609733,2200306550.00000,1653985193.00000,298326376,1316178497.00000,3007786442.00000,2064951626.00000,458293330,2589141269.00000,3591329599.00000,3164325604.00000,727753846,2179363840.00000,146436021,1461446943.00000,4069977195.00000,705550613,3059967265.00000,3887724982.00000,4281599278.00000,3313849956.00000,1404054877.00000,2845806497.00000,146425753,1854211946.00000;1266315497.00000,3048417604.00000,3681880366.00000,3289982499.00000,2909710000.00000,1235738493.00000,2632868024.00000,2414719590.00000,3970600049.00000,1771706367.00000,1449415276.00000,3266420449.00000,422970021,1963543593.00000,2690192192.00000,3826793022.00000,1062508698.00000,1531092325.00000,1804592342.00000,2583117782.00000,2714934279.00000,4024971509.00000,1294809318.00000,4028980673.00000,1289560198.00000,2221992742.00000,1669523910.00000,35572830,157838143,1052438473.00000,1016535060.00000,1802137761.00000,1753167236.00000,1386275462.00000,3080475397.00000,2857371447.00000,1040679964.00000,2145300060.00000,2390574316.00000,1461121720.00000,2956646967.00000,4031777805.00000,4028374788.00000,33600511,2920084762.00000,1018524850.00000,629373528,3691585981.00000,3515945977.00000,2091462646.00000,2486323059.00000,586499841,988145025,935516892,3367335476.00000,2599673255.00000,2839830854.00000,265290510,3972581182.00000,2759138881.00000,3795373465.00000,1005194799.00000,847297441,406762289,1314163512.00000,1332590856.00000,1866599683.00000,4127851711.00000,750260880,613907577,1450815602.00000,3165620655.00000,3734664991.00000,3650291728.00000,3012275730.00000,3704569646.00000,1427272223.00000,778793252,1343938022.00000,2676280711.00000,2052605720.00000,1946737175.00000,3164576444.00000,3914038668.00000,3967478842.00000,3682934266.00000,1661551462.00000,3294938066.00000,4011595847.00000,840292616,3712170807.00000,616741398,312560963,711312465,1351876610.00000,322626781,1910503582.00000,271666773,2175563734.00000,1594956187.00000,70604529,3617834859.00000,1007753275.00000,1495573769.00000,4069517037.00000,2549218298.00000,2663038764.00000,504708206,2263041392.00000,3941167025.00000,2249088522.00000,1514023603.00000,1998579484.00000,1312622330.00000,694541497,2582060303.00000,2151582166.00000,1382467621.00000,776784248,2618340202.00000,3323268794.00000,2497899128.00000,2784771155.00000,503983604,4076293799.00000,907881277,423175695,432175456,1378068232.00000,4145222326.00000,3954048622.00000,3938656102.00000,3820766613.00000,2793130115.00000,2977904593.00000,26017576,3274890735.00000,3194772133.00000,1700274565.00000,1756076034.00000,4006520079.00000,3677328699.00000,720338349,1533947780.00000,354530856,688349552,3973924725.00000,1637815568.00000,332179504,3949051286.00000,53804574,2852348879.00000,3044236432.00000,1282449977.00000,3583942155.00000,3416972820.00000,4006381244.00000,1617046695.00000,2628476075.00000,3002303598.00000,1686838959.00000,431878346,2686675385.00000,1700445008.00000,1080580658.00000,1009431731.00000,832498133,3223435511.00000,2605976345.00000,2271191193.00000,2516031870.00000,1648197032.00000,4164389018.00000,2548247927.00000,300782431,375919233,238389289,3353747414.00000,2531188641.00000,2019080857.00000,1475708069.00000,455242339,2609103871.00000,448939670,3451063019.00000,1395535956.00000,2413381860.00000,1841049896.00000,1491858159.00000,885456874,4264095073.00000,4001119347.00000,1565136089.00000,3898914787.00000,1108368660.00000,540939232,1173283510.00000,2745871338.00000,3681308437.00000,4207628240.00000,3343053890.00000,4016749493.00000,1699691293.00000,1103962373.00000,3625875870.00000,2256883143.00000,3830138730.00000,1031889488.00000,3479347698.00000,1535977030.00000,4236805024.00000,3251091107.00000,2132092099.00000,1774941330.00000,1199868427.00000,1452454533.00000,157007616,2904115357.00000,342012276,595725824,1480756522.00000,206960106,497939518,591360097,863170706,2375253569.00000,3596610801.00000,1814182875.00000,2094937945.00000,3421402208.00000,1082520231.00000,3463918190.00000,2785509508.00000,435703966,3908032597.00000,1641649973.00000,2842273706.00000,3305899714.00000,1510255612.00000,2148256476.00000,2655287854.00000,3276092548.00000,4258621189.00000,236887753,3681803219.00000,274041037,1734335097.00000,3815195456.00000,3317970021.00000,1899903192.00000,1026095262.00000,4050517792.00000,356393447,2410691914.00000,3873677099.00000,3682840055.00000;3913112168.00000,2491498743.00000,4132185628.00000,2489919796.00000,1091903735.00000,1979897079.00000,3170134830.00000,3567386728.00000,3557303409.00000,857797738,1136121015.00000,1342202287.00000,507115054,2535736646.00000,337727348,3213592640.00000,1301675037.00000,2528481711.00000,1895095763.00000,1721773893.00000,3216771564.00000,62756741,2142006736.00000,835421444,2531993523.00000,1442658625.00000,3659876326.00000,2882144922.00000,676362277,1392781812.00000,170690266,3921047035.00000,1759253602.00000,3611846912.00000,1745797284.00000,664899054,1329594018.00000,3901205900.00000,3045908486.00000,2062866102.00000,2865634940.00000,3543621612.00000,3464012697.00000,1080764994.00000,553557557,3656615353.00000,3996768171.00000,991055499,499776247,1265440854.00000,648242737,3940784050.00000,980351604,3713745714.00000,1749149687.00000,3396870395.00000,4211799374.00000,3640570775.00000,1161844396.00000,3125318951.00000,1431517754.00000,545492359,4268468663.00000,3499529547.00000,1437099964.00000,2702547544.00000,3433638243.00000,2581715763.00000,2787789398.00000,1060185593.00000,1593081372.00000,2418618748.00000,4260947970.00000,69676912,2159744348.00000,86519011,2512459080.00000,3838209314.00000,1220612927.00000,3339683548.00000,133810670,1090789135.00000,1078426020.00000,1569222167.00000,845107691,3583754449.00000,4072456591.00000,1091646820.00000,628848692,1613405280.00000,3757631651.00000,526609435,236106946,48312990,2942717905.00000,3402727701.00000,1797494240.00000,859738849,992217954,4005476642.00000,2243076622.00000,3870952857.00000,3732016268.00000,765654824,3490871365.00000,2511836413.00000,1685915746.00000,3888969200.00000,1414112111.00000,2273134842.00000,3281911079.00000,4080962846.00000,172450625,2569994100.00000,980381355,4109958455.00000,2819808352.00000,2716589560.00000,2568741196.00000,3681446669.00000,3329971472.00000,1835478071.00000,660984891,3704678404.00000,4045999559.00000,3422617507.00000,3040415634.00000,1762651403.00000,1719377915.00000,3470491036.00000,2693910283.00000,3642056355.00000,3138596744.00000,1364962596.00000,2073328063.00000,1983633131.00000,926494387,3423689081.00000,2150032023.00000,4096667949.00000,1749200295.00000,3328846651.00000,309677260,2016342300.00000,1779581495.00000,3079819751.00000,111262694,1274766160.00000,443224088,298511866,1025883608.00000,3806446537.00000,1145181785.00000,168956806,3641502830.00000,3584813610.00000,1689216846.00000,3666258015.00000,3200248200.00000,1692713982.00000,2646376535.00000,4042768518.00000,1618508792.00000,1610833997.00000,3523052358.00000,4130873264.00000,2001055236.00000,3610705100.00000,2202168115.00000,4028541809.00000,2961195399.00000,1006657119.00000,2006996926.00000,3186142756.00000,1430667929.00000,3210227297.00000,1314452623.00000,4074634658.00000,4101304120.00000,2273951170.00000,1399257539.00000,3367210612.00000,3027628629.00000,1190975929.00000,2062231137.00000,2333990788.00000,2221543033.00000,2438960610.00000,1181637006.00000,548689776,2362791313.00000,3372408396.00000,3104550113.00000,3145860560.00000,296247880,1970579870.00000,3078560182.00000,3769228297.00000,1714227617.00000,3291629107.00000,3898220290.00000,166772364,1251581989.00000,493813264,448347421,195405023,2709975567.00000,677966185,3703036547.00000,1463355134.00000,2715995803.00000,1338867538.00000,1343315457.00000,2802222074.00000,2684532164.00000,233230375,2599980071.00000,2000651841.00000,3277868038.00000,1638401717.00000,4028070440.00000,3237316320.00000,6314154,819756386,300326615,590932579,1405279636.00000,3267499572.00000,3150704214.00000,2428286686.00000,3959192993.00000,3461946742.00000,1862657033.00000,1266418056.00000,963775037,2089974820.00000,2263052895.00000,1917689273.00000,448879540,3550394620.00000,3981727096.00000,150775221,3627908307.00000,1303187396.00000,508620638,2975983352.00000,2726630617.00000,1817252668.00000,1876281319.00000,1457606340.00000,908771278,3720792119.00000,3617206836.00000,2455994898.00000,1729034894.00000,1080033504.00000;976866871,3556439503.00000,2881648439.00000,1522871579.00000,1555064734.00000,1336096578.00000,3548522304.00000,2579274686.00000,3574697629.00000,3205460757.00000,3593280638.00000,3338716283.00000,3079412587.00000,564236357,2993598910.00000,1781952180.00000,1464380207.00000,3163844217.00000,3332601554.00000,1699332808.00000,1393555694.00000,1183702653.00000,3581086237.00000,1288719814.00000,691649499,2847557200.00000,2895455976.00000,3193889540.00000,2717570544.00000,1781354906.00000,1676643554.00000,2592534050.00000,3230253752.00000,1126444790.00000,2770207658.00000,2633158820.00000,2210423226.00000,2615765581.00000,2414155088.00000,3127139286.00000,673620729,2805611233.00000,1269405062.00000,4015350505.00000,3341807571.00000,4149409754.00000,1057255273.00000,2012875353.00000,2162469141.00000,2276492801.00000,2601117357.00000,993977747,3918593370.00000,2654263191.00000,753973209,36408145,2530585658.00000,25011837,3520020182.00000,2088578344.00000,530523599,2918365339.00000,1524020338.00000,1518925132.00000,3760827505.00000,3759777254.00000,1202760957.00000,3985898139.00000,3906192525.00000,674977740,4174734889.00000,2031300136.00000,2019492241.00000,3983892565.00000,4153806404.00000,3822280332.00000,352677332,2297720250.00000,60907813,90501309,3286998549.00000,1016092578.00000,2535922412.00000,2839152426.00000,457141659,509813237,4120667899.00000,652014361,1966332200.00000,2975202805.00000,55981186,2327461051.00000,676427537,3255491064.00000,2882294119.00000,3433927263.00000,1307055953.00000,942726286,933058658,2468411793.00000,3933900994.00000,4215176142.00000,1361170020.00000,2001714738.00000,2830558078.00000,3274259782.00000,1222529897.00000,1679025792.00000,2729314320.00000,3714953764.00000,1770335741.00000,151462246,3013232138.00000,1682292957.00000,1483529935.00000,471910574,1539241949.00000,458788160,3436315007.00000,1807016891.00000,3718408830.00000,978976581,1043663428.00000,3165965781.00000,1927990952.00000,4200891579.00000,2372276910.00000,3208408903.00000,3533431907.00000,1412390302.00000,2931980059.00000,4132332400.00000,1947078029.00000,3881505623.00000,4168226417.00000,2941484381.00000,1077988104.00000,1320477388.00000,886195818,18198404,3786409000.00000,2509781533.00000,112762804,3463356488.00000,1866414978.00000,891333506,18488651,661792760,1628790961.00000,3885187036.00000,3141171499.00000,876946877,2693282273.00000,1372485963.00000,791857591,2686433993.00000,3759982718.00000,3167212022.00000,3472953795.00000,2716379847.00000,445679433,3561995674.00000,3504004811.00000,3574258232.00000,54117162,3331405415.00000,2381918588.00000,3769707343.00000,4154350007.00000,1140177722.00000,4074052095.00000,668550556,3214352940.00000,367459370,261225585,2610173221.00000,4209349473.00000,3468074219.00000,3265815641.00000,314222801,3066103646.00000,3808782860.00000,282218597,3406013506.00000,3773591054.00000,379116347,1285071038.00000,846784868,2669647154.00000,3771962079.00000,3550491691.00000,2305946142.00000,453669953,1268987020.00000,3317592352.00000,3279303384.00000,3744833421.00000,2610507566.00000,3859509063.00000,266596637,3847019092.00000,517658769,3462560207.00000,3443424879.00000,370717030,4247526661.00000,2224018117.00000,4143653529.00000,4112773975.00000,2788324899.00000,2477274417.00000,1456262402.00000,2901442914.00000,1517677493.00000,1846949527.00000,2295493580.00000,3734397586.00000,2176403920.00000,1280348187.00000,1908823572.00000,3871786941.00000,846861322,1172426758.00000,3287448474.00000,3383383037.00000,1655181056.00000,3139813346.00000,901632758,1897031941.00000,2986607138.00000,3066810236.00000,3447102507.00000,1393639104.00000,373351379,950779232,625454576,3124240540.00000,4148612726.00000,2007998917.00000,544563296,2244738638.00000,2330496472.00000,2058025392.00000,1291430526.00000,424198748,50039436,29584100,3605783033.00000,2429876329.00000,2791104160.00000,1057563949.00000,3255363231.00000,3075367218.00000,3463963227.00000,1469046755.00000,985887462] ;
            obj.P = [608135816,2242054355.00000,320440878,57701188,2752067618.00000,698298832,137296536,3964562569.00000,1160258022.00000,953160567,3193202383.00000,887688300,3232508343.00000,3380367581.00000,1065670069.00000,3041331479.00000,2450970073.00000,2306472731.00000] ;
            obj.N = 16;
        end
        function [x] = Blowfish_encipher(obj,x)
            hex1 = 4294967295.00000;
            hex2 = 1.84467440694146e+19;
            xr = bitand(x,hex1);
            t = bitand(x,hex2);
            xl = bitshift(t,-32);
            n = obj.N;
            for i = 1:n
                xl = bitxor(xl,obj.P(i));
                t = obj.F(xl);
                xr = bitxor(t,xr);
                
                t = xl;
                xl = xr;
                xr = t;
            end
            
            t = xl;
            xl = xr;
            xr = t;
            
            xr = bitxor(xr,obj.P(n+1));
            xl = bitxor(xl,obj.P(n+2));
            x = bitor(bitshift(xl,32),xr);
        end
        function [obj] = InitializeBlowfish( obj , key , keybytes)
            j=1;
            n = obj.N;
            hex1 = 4294967295.00000;
            hex2 = 1.84467440694146e+19;
            for i = 1:n+2
                data = 0;
                for k = 1:4
                    bitshiftd = bitshift(data,8);
                    data = bitor(bitshiftd,key(j));
                    j = j + 1;
                    if j>keybytes
                        j=1;
                    end
                end
                obj.P(i) = bitxor(obj.P(i),data);
            end
            data = 0;
            for i = 1:2:18
                data = Blowfish_encipher(obj,data);
                obj.P(i) = bitand(data,hex1);
                bitandd = bitand(data,hex2);
                obj.P(i+1) = bitshift(bitandd,-32);
            end
            for i = 1:4
                for j = 1:2:256
                    data = Blowfish_encipher(obj,data);
                    obj.P(i,j) = bitand(data,hex1);
                    bitandd = bitand(data,hex2);
                    obj.P(i,j+1) = bitshift(bitandd,-32);
                end
            end
            
        end
        
        function [x] = Blowfish_decipher(obj,x)
            hex1 = 4294967295.00000;
            hex2 = 1.84467440694146e+19;
            xr = bitand(x,hex1);
            temp = bitand(x,hex2);
            xl = bitshift(temp,-32);
            n = obj.N;
            for i = n+2:-1:3
                xl = bitxor(xl,obj.P(i));
                temp = F(obj,xl);
                xr = bitxor(temp,xr);
                
                temp = xl;
                xl = xr;
                xr = temp;
            end
            
            temp = xl;
            xl = xr;
            xr = temp;
            
            xr = bitxor(xr,obj.P(2));
            xl = bitxor(xl,obj.P(1));
            x = bitor(bitshift(xl,32),xr);
        end
        
        function y = F(obj,x)
            hexx = 255;
            a = [0,0,0,0];
            
            for i=1:4
                a(i) = bitshift(x,-32+8*i);
                a(i) = bitand(a(i),hexx);
                a(i) = obj.sbox(i,a(i)+1);
            end
            a(1) = (a(1)+a(2));
            y = bitxor(a(1),a(3))+a(4);
            y = mod(y,4294967296);
        end

    end
    
end

